import { Component, OnInit, Input, Output, EventEmitter } from '@angular/core';
import { CaptchaStore } from '../../store/captcha/captcha.store';
import { CaptchaService } from '../../store/captcha/captcha.service';
import { DomSanitizer, SafeHtml } from '@angular/platform-browser';

@Component({
    selector: 'app-captcha',
    templateUrl: './captcha.component.html',
    styleUrls: ['./captcha.component.scss'],
})
export class CaptchaComponent implements OnInit {
    maxLengthInput: number = 6;
    @Input() config: any = {
        type: 1,
        length: this.maxLengthInput,
        cssClass: 'custom',
        back: {
            stroke: '#8391a2',
            solid: '#f0f4ff',
        },
        font: {
            color: '#3d4f95',
            size: '40px',
            family: 'Arial',
        },
    };
    @Output() captchaCode = new EventEmitter<string>();

    captch_input: string = '';
    code: string = '';
    isCaptchaValid: boolean = true;
    captchaSvg: SafeHtml = ''; // ปลอดภัยสำหรับการแสดงใน HTML

    constructor(private sanitizer: DomSanitizer) { }

    ngOnInit(): void {
        this.createCaptcha('');
    }

    createCaptcha(actions) {
        // สมมติ response นี้มาจาก backend
        let caseType = actions;
        let body;
        if (caseType  == '1') {
             body = {
                "captchaSvg": "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"150\" height=\"50\"><path fill=\"#444\" d=\"M24.58 14.16L24.48 14.05L24.53 14.11Q25.37 16.01 27.05 16.35L27.09 16.40L27.06 16.37Q27.63 16.52 28.32 16.33L28.35 16.36L28.24 16.26Q28.09 22.23 28.01 28.09L27.95 28.04L28.10 28.19Q28.02 33.93 28.25 39.87L28.26 39.88L28.15 39.77Q28.04 39.88 27.73 39.88L27.61 39.76L27.66 39.82Q26.07 39.78 24.77 41.61L24.90 41.73L24.71 41.54Q25.58 34.80 25.54 27.94L25.36 27.77L25.37 27.78Q25.41 21.00 24.57 14.15ZM24.35 42.74L24.44 42.83L24.48 42.87Q25.40 40.90 26.47 40.45L26.60 40.58L26.43 40.41Q26.52 41.60 26.52 42.59L26.45 42.52L26.40 42.47Q27.19 42.16 27.99 42.27L27.93 42.22L27.87 42.15Q29.94 42.50 31.15 45.21L31.17 45.22L31.14 45.20Q29.97 37.66 29.97 30.20L29.94 30.18L30.07 30.30Q30.05 22.56 30.89 15.25L30.87 15.23L30.91 15.27Q29.93 17.18 28.79 17.79L28.82 17.82L28.68 17.68Q28.65 16.63 28.73 15.56L28.77 15.60L28.89 15.72Q27.92 16.05 27.16 15.90L27.30 16.04L27.15 15.88Q25.01 15.54 24.02 12.68L24.05 12.71L23.94 12.61Q25.15 20.29 25.23 27.82L25.11 27.70L25.05 27.64Q25.24 35.22 24.36 42.76Z\"/><path fill=\"#222\" d=\"M56.26 29.16L56.36 29.26L56.29 29.19Q54.39 29.16 53.17 30.49L53.19 30.50L53.20 30.51Q51.97 31.84 51.82 33.74L51.90 33.83L51.86 33.78Q51.69 35.93 52.90 36.94L52.96 36.99L52.96 36.99Q53.99 37.82 56.12 37.74L56.27 37.89L56.23 37.85Q58.57 37.72 59.52 36.76L59.51 36.75L59.54 36.78Q60.51 35.27 60.39 33.44L60.42 33.47L60.31 33.36Q60.26 31.56 59.18 30.36L59.10 30.29L59.18 30.36Q58.13 29.21 56.31 29.21ZM56.15 19.65L56.28 19.78L56.19 19.69Q54.76 19.55 53.43 20.05L53.49 20.11L53.57 20.19Q52.14 20.85 52.37 22.72L52.40 22.75L52.40 22.75Q52.95 26.54 56.30 26.54L56.20 26.44L56.30 26.54Q57.88 26.75 58.87 25.60L58.92 25.65L58.88 25.61Q59.83 24.43 59.86 22.87L59.79 22.80L59.91 22.91Q59.87 21.04 59.15 20.43L59.32 20.60L59.20 20.49Q57.52 19.64 56.22 19.72ZM56.00 40.32L55.96 40.28L52.84 40.20L53.00 40.37Q51.36 40.25 50.03 39.38L50.09 39.43L50.17 39.51Q48.76 38.34 48.92 35.48L48.87 35.44L48.91 35.48Q49.28 28.54 52.90 27.55L52.92 27.58L52.97 27.62Q50.63 26.65 49.30 21.28L49.32 21.31L49.32 21.31Q49.06 19.98 49.13 19.18L49.05 19.10L49.04 19.09Q49.33 16.94 53.02 16.90L53.10 16.98L53.02 16.90Q57.18 16.76 58.63 16.95L58.80 17.12L58.78 17.10Q62.52 17.53 62.98 19.55L62.93 19.50L62.99 19.56Q63.07 20.14 63.07 20.52L63.08 20.52L63.04 20.49Q63.21 21.34 63.02 21.95L62.96 21.89L62.96 21.89Q62.38 26.14 59.45 27.66L59.46 27.68L59.39 27.61Q62.89 28.41 63.39 33.70L63.34 33.65L63.35 33.66Q63.45 33.91 63.49 35.21L63.39 35.11L63.45 35.17Q63.51 37.89 61.91 38.96L62.01 39.06L62.00 39.05Q60.55 39.85 55.98 40.30ZM58.22 42.58L58.34 42.70L61.56 42.65L61.65 42.73Q63.32 42.77 64.85 42.05L64.86 42.06L64.88 42.09Q66.04 41.37 66.11 39.51L66.02 39.42L66.08 39.47Q66.14 38.40 65.76 36.46L65.80 36.49L65.67 36.36Q64.91 31.87 62.81 30.00L62.75 29.93L62.61 29.61L62.33 29.25L62.15 28.96L62.28 29.09Q63.82 27.63 64.74 23.48L64.72 23.46L64.70 23.44Q64.77 23.13 64.85 22.29L64.73 22.18L64.74 22.18Q64.98 21.66 64.90 21.05L64.87 21.02L64.72 20.87Q64.73 19.59 63.55 19.09L63.53 19.07L63.49 18.99L63.43 19.01L63.30 18.87Q63.11 18.24 61.93 17.44L61.92 17.42L61.88 17.34L61.93 17.40Q59.99 16.75 55.91 16.56L55.82 16.46L55.84 16.49Q54.24 16.33 52.87 16.44L52.87 16.45L52.91 16.48Q52.09 16.50 50.79 16.65L50.77 16.63L50.90 16.75Q48.94 17.12 48.71 18.76L48.61 18.65L48.69 18.73Q48.66 19.23 48.69 20.03L48.72 20.06L48.62 19.96Q48.88 20.64 49.45 23.00L49.33 22.88L49.41 22.95Q50.08 26.07 51.83 27.40L51.85 27.42L51.90 27.47L51.92 27.49Q49.23 28.87 48.69 34.04L48.72 34.07L48.59 33.94Q48.57 36.31 48.57 37.23L48.45 37.11L48.55 37.21Q48.46 38.84 49.64 39.75L49.80 39.90L49.70 39.81Q49.89 39.96 50.16 40.15L50.14 40.14L50.06 40.05Q51.08 42.33 58.20 42.56ZM57.84 31.47L58.02 31.64L57.86 31.49Q58.87 31.50 59.74 31.96L59.76 31.98L59.75 31.97Q60.15 32.97 60.11 33.51L60.08 33.48L60.14 33.53Q60.13 33.79 60.13 34.09L60.13 34.10L60.10 34.06Q60.08 36.41 57.80 37.24L57.78 37.23L57.80 37.25Q56.99 37.54 56.19 37.43L56.15 37.39L56.17 37.41Q55.04 37.49 53.89 37.03L53.98 37.12L54.06 37.20Q53.60 36.36 53.68 35.37L53.69 35.38L53.74 35.44Q53.86 33.80 55.06 32.58L55.23 32.75L55.08 32.61Q56.29 31.39 57.88 31.51ZM58.11 22.03L58.12 22.04L58.16 22.08Q58.92 21.92 59.45 22.07L59.39 22.01L59.57 23.00L59.42 22.84Q59.40 24.23 58.48 25.23L58.64 25.39L58.57 25.32Q57.71 26.38 56.34 26.19L56.36 26.22L56.19 26.04Q55.29 26.14 54.88 25.91L54.88 25.91L54.80 25.84Q54.87 25.68 54.76 24.99L54.82 25.05L54.64 24.88Q54.40 23.50 55.62 22.66L55.66 22.70L55.76 22.79Q56.83 22.11 58.24 22.15Z\"/><path fill=\"#111\" d=\"M87.86 27.74L87.84 27.71L87.77 27.65Q84.39 27.69 83.28 31.04L83.19 30.95L83.13 30.88Q82.85 32.05 82.73 33.11L82.72 33.10L82.75 33.14Q82.50 35.13 83.49 36.46L83.56 36.53L83.48 36.45Q84.87 37.69 87.35 37.73L87.36 37.74L87.30 37.68Q89.14 37.73 90.55 36.59L90.60 36.64L90.61 36.65Q91.92 35.41 91.92 33.62L91.94 33.64L91.93 33.63Q91.90 33.26 91.83 32.88L91.86 32.92L91.89 32.94Q91.70 27.84 87.89 27.77ZM87.85 40.28L87.74 40.17L87.72 40.15Q83.90 40.37 82.11 38.35L82.12 38.36L82.21 38.46Q81.88 39.38 81.42 40.75L81.38 40.71L81.53 40.86Q79.55 41.58 78.29 42.15L78.19 42.05L78.32 42.17Q80.42 36.13 80.42 29.62L80.35 29.55L80.46 29.66Q80.48 21.38 77.05 13.54L77.05 13.54L76.96 13.44Q79.37 14.87 80.71 15.33L80.67 15.29L80.61 15.23Q82.86 22.01 83.02 27.84L82.86 27.68L82.97 27.80Q84.49 25.20 88.22 25.24L88.11 25.13L88.20 25.22Q91.39 25.21 92.88 27.08L92.90 27.11L92.81 27.01Q94.68 29.34 94.83 32.92L94.72 32.81L94.79 32.87Q94.89 34.08 94.82 35.68L94.76 35.63L94.76 35.62Q94.79 37.13 93.91 38.28L93.89 38.26L93.85 38.22Q92.09 39.92 87.75 40.18ZM93.32 42.79L93.20 42.67L93.31 42.78Q94.81 42.79 96.29 42.10L96.34 42.15L96.20 42.02Q97.31 40.72 97.34 38.78L97.29 38.72L97.37 38.81Q97.46 38.39 97.30 37.21L97.17 37.08L97.14 37.05Q97.08 36.38 96.97 35.47L97.10 35.61L97.01 35.51Q96.25 30.79 94.69 28.74L94.63 28.67L94.70 28.74Q94.68 28.69 93.88 27.81L93.87 27.81L93.80 27.73Q93.56 27.45 93.03 26.66L93.03 26.67L93.03 26.66Q91.39 24.68 88.04 24.72L88.04 24.72L88.15 24.82Q86.03 24.80 84.77 25.41L84.74 25.38L84.86 25.50Q84.39 20.84 83.78 17.64L83.79 17.65L83.82 17.68Q83.11 17.54 81.63 17.16L81.62 17.15L81.65 17.18Q81.51 16.43 81.05 14.98L81.03 14.97L81.04 14.98Q78.55 14.12 76.30 12.56L76.31 12.56L76.30 12.56Q80.24 20.91 80.24 29.70L80.10 29.57L80.17 29.63Q80.10 36.53 77.62 42.74L77.63 42.74L77.67 42.79Q78.32 42.40 79.65 41.83L79.68 41.86L79.66 41.84Q79.43 42.60 78.82 44.13L78.80 44.11L78.88 44.18Q80.73 43.14 83.51 42.61L83.55 42.65L83.97 40.86L84.08 40.97Q86.21 42.49 93.14 42.61ZM89.43 29.99L89.47 30.03L89.42 29.98Q90.48 30.01 91.02 30.40L91.01 30.39L91.05 30.43Q91.29 30.86 91.52 32.87L91.58 32.94L91.47 32.82Q91.72 34.75 90.46 36.06L90.44 36.04L90.51 36.11Q89.35 37.52 87.41 37.41L87.26 37.26L87.35 37.35Q86.32 37.39 84.84 36.90L84.92 36.98L84.84 36.90Q84.73 36.52 84.73 35.99L84.71 35.96L84.77 36.03Q84.71 32.88 86.27 31.29L86.21 31.23L86.19 31.24L86.24 31.29Q87.65 29.89 89.40 29.96Z\"/><path fill=\"#333\" d=\"M124.08 40.35L124.09 40.36L124.03 40.30Q121.07 36.43 118.45 27.79L118.52 27.86L118.60 27.94Q117.85 25.70 117.05 23.57L116.97 23.49L114.21 32.39L114.10 32.28Q112.38 37.29 109.98 40.52L109.87 40.42L109.96 40.51Q109.11 40.56 107.47 40.72L107.52 40.76L107.43 40.68Q107.68 39.63 107.68 38.38L107.68 38.38L107.65 38.35Q107.64 32.32 104.90 26.19L104.90 26.19L104.79 26.08Q101.79 19.32 95.93 14.33L95.84 14.24L95.92 14.33Q97.94 14.89 100.30 15.42L100.45 15.58L100.44 15.57Q109.00 23.90 110.30 34.86L110.30 34.87L110.34 34.91Q111.94 31.56 113.39 26.19L113.41 26.22L113.49 26.30Q115.30 18.63 115.79 17.22L115.99 17.41L118.21 17.39L118.07 17.25Q118.77 19.28 119.41 21.60L119.47 21.66L120.80 26.18L120.78 26.16Q122.25 31.52 123.66 34.76L123.68 34.77L123.62 34.71Q125.44 23.24 133.36 15.90L133.26 15.80L133.21 15.75Q134.73 15.41 137.70 14.76L137.81 14.87L137.79 14.85Q132.47 19.16 129.42 25.28L129.38 25.24L129.31 25.18Q126.39 31.58 126.39 38.35L126.30 38.27L126.23 38.19Q126.29 39.36 126.37 40.50L126.32 40.46L125.28 40.45L125.29 40.46Q124.72 40.42 124.15 40.42ZM130.27 43.19L130.30 43.22L130.35 43.27Q129.04 39.64 129.15 35.75L129.13 35.73L129.13 35.73Q129.65 24.37 139.01 16.11L138.97 16.07L138.83 15.93Q137.96 16.24 136.02 16.77L135.95 16.70L136.04 16.79Q136.91 15.87 138.81 14.08L138.85 14.12L138.86 14.13Q136.23 14.93 133.30 15.42L133.25 15.37L133.31 15.43Q125.86 22.60 123.96 32.08L123.81 31.93L123.80 31.92Q123.32 30.38 120.47 18.92L120.38 18.83L120.52 18.98Q120.03 18.98 119.08 18.98L119.05 18.95L118.84 17.97L118.76 17.90Q118.68 17.40 118.46 16.91L118.50 16.95L115.55 16.90L115.55 16.89Q114.75 19.37 113.48 24.49L113.41 24.43L113.47 24.49Q112.25 29.66 111.26 32.14L111.21 32.08L111.17 32.05Q109.53 24.09 103.97 17.77L104.13 17.92L103.96 17.76Q103.51 17.73 102.56 17.54L102.54 17.52L102.62 17.59Q101.81 16.67 100.25 15.03L100.24 15.03L100.25 15.03Q96.96 14.34 94.79 13.54L94.77 13.51L94.80 13.54Q100.44 18.19 103.71 24.40L103.61 24.30L103.77 24.46Q107.09 30.94 107.09 37.94L107.16 38.01L107.08 37.93Q107.19 39.60 107.00 41.20L107.04 41.24L106.94 41.14Q107.23 41.20 107.68 41.10L107.63 41.05L107.60 41.02Q108.06 40.93 108.29 40.93L108.39 41.03L108.40 42.07L108.36 42.03Q108.36 42.49 108.44 43.02L108.45 43.03L108.48 43.06Q109.56 42.93 111.85 42.77L111.81 42.74L111.93 42.86Q115.53 37.44 118.27 28.03L118.24 28.00L118.22 27.98Q120.92 36.69 123.89 40.65L123.91 40.67L123.95 40.71Q124.46 40.77 125.30 40.88L125.27 40.86L125.35 40.93Q126.20 41.97 127.26 43.04L127.26 43.04L127.19 42.96Q128.05 43.10 130.45 43.37Z\"/><path d=\"M6 17 C57 7,69 23,130 48\" stroke=\"#666\" fill=\"none\"/></svg>",
                "sessionId": "66cefb765b9090bcfc680542",
                "message": "Success"
            }
        }else{
             body = {
                "captchaSvg": "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"150\" height=\"50\"><path fill=\"#444\" d=\"M58.24 27.71L58.23 27.70L58.31 27.78Q54.65 27.55 53.54 30.90L53.68 31.04L53.71 31.06Q53.35 32.15 53.23 33.21L53.25 33.23L53.10 33.08Q53.00 35.22 53.99 36.55L53.99 36.56L54.02 36.59Q55.17 37.58 57.64 37.62L57.79 37.77L57.64 37.63Q59.53 37.73 60.94 36.58L60.95 36.59L60.97 36.61Q62.32 35.41 62.32 33.62L62.34 33.65L62.36 33.66Q62.31 33.27 62.23 32.88L62.24 32.89L62.35 33.00Q62.06 27.81 58.26 27.73ZM58.06 40.10L58.06 40.10L58.06 40.10Q54.43 40.50 52.64 38.48L52.58 38.43L52.49 38.33Q52.34 39.44 51.88 40.81L51.80 40.73L51.82 40.75Q49.86 41.49 48.60 42.06L48.70 42.16L48.58 42.03Q50.89 36.20 50.89 29.69L50.78 29.58L50.85 29.65Q50.91 21.41 47.48 13.57L47.51 13.59L47.34 13.43Q49.76 14.85 51.09 15.31L51.04 15.26L51.02 15.24Q53.16 21.91 53.32 27.74L53.35 27.77L53.27 27.69Q54.85 25.17 58.58 25.20L58.44 25.06L58.55 25.16Q61.70 25.12 63.18 26.99L63.28 27.08L63.20 27.00Q65.07 29.33 65.22 32.91L65.15 32.84L65.22 32.91Q65.22 34.01 65.14 35.61L65.26 35.73L65.20 35.66Q65.07 37.02 64.19 38.16L64.21 38.17L64.30 38.27Q62.47 39.90 58.13 40.17ZM63.68 42.74L63.55 42.62L63.70 42.77Q65.21 42.79 66.70 42.11L66.55 41.97L66.67 42.08Q67.77 40.78 67.80 38.84L67.69 38.72L67.74 38.77Q67.76 38.30 67.60 37.12L67.63 37.14L67.63 37.15Q67.47 36.37 67.35 35.46L67.48 35.58L67.35 35.45Q66.70 30.84 65.14 28.79L65.03 28.68L64.96 28.61Q64.96 28.57 64.16 27.70L64.34 27.87L64.30 27.83Q63.98 27.48 63.45 26.68L63.45 26.68L63.58 26.81Q61.84 24.73 58.49 24.76L58.62 24.90L58.59 24.86Q56.46 24.83 55.21 25.44L55.21 25.45L55.17 25.41Q54.92 20.96 54.31 17.77L54.19 17.65L54.37 17.82Q53.47 17.50 51.98 17.12L52.03 17.16L51.98 17.11Q51.93 16.45 51.47 15.00L51.40 14.93L51.48 15.02Q48.92 14.09 46.68 12.53L46.82 12.68L46.73 12.59Q50.56 20.84 50.56 29.63L50.55 29.62L50.52 29.59Q50.45 36.48 47.97 42.69L48.07 42.78L48.13 42.84Q48.72 42.40 50.05 41.83L50.16 41.94L50.01 41.79Q49.93 42.70 49.32 44.23L49.19 44.10L49.19 44.10Q51.24 43.25 54.02 42.72L54.05 42.75L54.41 40.90L54.35 40.84Q56.78 42.66 63.71 42.78ZM59.82 29.98L59.90 30.06L59.86 30.02Q60.94 30.07 61.47 30.45L61.39 30.37L61.43 30.41Q61.69 30.86 61.92 32.88L61.96 32.92L61.89 32.85Q62.16 34.79 60.90 36.10L60.98 36.19L60.96 36.16Q59.75 37.53 57.81 37.41L57.65 37.25L57.71 37.31Q56.77 37.44 55.29 36.95L55.33 36.98L55.29 36.95Q55.17 36.56 55.17 36.02L55.01 35.87L55.11 35.96Q55.09 32.86 56.65 31.27L56.68 31.29L56.66 31.31L56.66 31.31Q58.20 30.03 59.95 30.11Z\"/><path fill=\"#333\" d=\"M20.91 49.62L20.86 49.57L20.94 49.65Q23.80 45.74 26.70 39.53L26.67 39.51L26.79 39.62Q23.51 32.92 17.42 24.85L17.58 25.01L17.41 24.84Q19.45 26.11 22.23 26.76L22.13 26.67L22.26 26.79Q25.63 31.30 28.06 36.52L28.20 36.66L28.10 36.56Q30.29 31.28 33.37 26.87L33.37 26.87L33.44 26.93Q35.66 26.60 37.75 25.80L37.69 25.74L37.69 25.74Q34.35 29.64 30.89 37.06L30.75 36.92L27.93 42.94L28.07 43.08Q26.49 46.07 24.74 48.69L24.75 48.70L24.84 48.79Q22.29 49.02 20.84 49.55ZM27.10 50.97L27.18 51.06L27.17 51.05Q28.83 48.10 30.27 44.82L30.17 44.72L32.94 38.43L33.03 38.52Q36.58 30.54 39.89 26.54L39.74 26.38L39.87 26.52Q38.45 27.11 36.54 27.80L36.50 27.75L37.64 26.46L37.53 26.34Q38.19 25.74 38.80 25.06L38.80 25.07L38.73 25.00Q36.15 26.14 33.29 26.60L33.24 26.55L33.20 26.51Q30.50 30.47 28.56 34.92L28.44 34.80L28.58 34.94Q26.93 31.62 25.14 28.80L25.20 28.86L25.12 28.78Q24.98 28.83 24.62 28.80L24.62 28.79L24.55 28.73Q24.17 28.67 23.98 28.67L24.02 28.71L24.01 28.70Q23.24 27.44 22.29 26.30L22.26 26.26L22.30 26.30Q19.04 25.56 16.30 23.85L16.35 23.89L16.40 23.95Q22.65 31.95 26.35 39.56L26.23 39.44L26.24 39.46Q24.17 44.62 20.09 50.25L20.02 50.18L20.11 50.27Q20.94 50.00 21.74 49.85L21.67 49.77L23.37 49.49L23.29 49.42Q22.79 50.25 21.61 51.88L21.53 51.80L21.45 51.72Q23.88 51.26 27.16 51.03Z\"/><path fill=\"#111\" d=\"M116.67 28.80L116.63 28.75L116.70 28.82Q114.05 28.68 112.75 29.82L112.89 29.96L112.93 30.00Q111.40 31.14 111.59 33.65L111.62 33.67L111.55 33.60Q111.79 36.51 112.97 37.58L113.05 37.66L113.00 37.61Q114.49 38.90 116.58 38.75L116.57 38.74L116.62 38.79Q118.83 38.87 120.24 37.61L120.20 37.58L120.23 37.61Q121.42 36.32 121.61 33.77L121.65 33.81L121.64 33.80Q122.02 28.88 116.65 28.77ZM116.53 41.33L116.63 41.43L115.00 41.36L115.07 41.43Q112.04 41.25 110.55 39.84L110.65 39.94L110.54 39.83Q109.56 38.82 109.30 36.87L109.45 37.03L109.33 36.91Q109.31 35.93 109.15 33.72L108.99 33.56L109.05 33.61Q108.91 32.57 108.80 30.32L108.91 30.44L108.97 30.49Q108.76 28.50 109.72 27.36L109.72 27.36L109.71 27.35Q111.55 25.96 116.27 26.11L116.31 26.15L116.17 26.00Q121.14 26.22 122.97 27.74L122.97 27.74L122.87 27.64Q124.40 28.91 124.21 32.10L124.20 32.10L124.30 32.19Q124.00 35.66 123.92 36.08L123.93 36.08L124.00 36.15Q123.63 38.37 122.29 39.55L122.25 39.51L122.26 39.52Q120.30 41.29 116.49 41.29ZM121.21 43.73L121.19 43.70L121.24 43.75Q122.66 43.73 124.56 43.57L124.65 43.66L124.62 43.63Q125.17 43.61 125.17 43.45L125.19 43.48L125.16 43.45Q125.10 43.31 125.06 43.16L125.02 43.12L125.12 43.22Q124.95 42.93 124.95 42.82L125.12 42.99L125.08 42.95Q125.00 42.61 125.35 42.30L125.42 42.37L125.44 42.39Q126.23 41.17 126.23 39.26L126.17 39.20L126.33 39.37Q126.27 38.35 126.17 35.93L126.17 35.93L126.16 35.92Q126.05 33.48 125.89 32.38L125.85 32.33L125.88 32.37Q125.44 30.18 124.53 29.04L124.67 29.18L124.24 28.86L124.34 28.96Q124.17 28.29 123.37 27.38L123.37 27.38L123.33 27.34Q121.07 25.66 116.16 25.66L116.20 25.69L114.40 25.65L114.43 25.67Q111.12 25.68 109.41 27.05L109.35 26.99L109.41 27.05Q108.51 28.13 108.55 30.15L108.50 30.10L108.51 30.11Q108.64 30.66 108.77 31.91L108.74 31.89L108.65 31.79Q108.82 33.08 108.78 33.54L108.89 33.65L108.90 33.65Q109.10 36.68 109.18 37.14L109.16 37.11L109.04 36.99Q109.45 39.16 110.36 40.30L110.29 40.22L110.51 40.52L110.54 40.55Q111.35 43.00 115.08 43.42L115.06 43.40L115.10 43.44Q115.99 43.57 121.25 43.76ZM118.42 31.00L118.48 31.06L118.55 31.12Q119.47 31.21 121.14 31.74L120.97 31.57L121.10 31.70Q121.48 32.46 121.45 33.95L121.45 33.95L121.34 33.84Q121.33 37.41 118.44 38.17L118.26 38.00L118.30 38.03Q117.71 38.36 116.68 38.47L116.52 38.31L116.54 38.33Q115.68 38.57 113.97 37.97L113.97 37.96L113.88 37.88Q113.53 37.07 113.57 35.59L113.56 35.58L113.56 35.57Q113.63 33.25 115.00 32.22L115.07 32.29L115.02 32.24Q115.95 31.38 118.50 31.08Z\"/><path fill=\"#222\" d=\"M84.54 25.04L84.53 25.04L84.48 24.98Q85.47 25.44 87.45 25.44L87.43 25.42L87.34 32.49L87.38 32.53Q87.46 36.83 87.58 39.73L87.53 39.68L87.51 39.66Q87.16 39.54 86.78 39.54L86.92 39.68L86.83 39.59Q85.35 39.55 83.90 40.89L83.92 40.91L83.89 40.88Q84.70 33.27 84.51 25.01ZM84.59 19.76L83.39 17.03L83.39 17.04Q84.91 15.98 85.64 15.02L85.63 15.02L85.78 15.17Q86.85 17.04 88.26 18.71L88.24 18.69L88.20 18.66Q87.42 20.20 86.05 22.33L86.11 22.39L86.08 22.36Q85.25 21.18 84.68 19.85L84.64 19.81ZM83.38 41.77L83.43 41.82L83.40 41.79Q84.43 40.73 85.69 40.24L85.64 40.19L85.65 40.20Q85.59 40.83 85.48 42.20L85.63 42.35L85.57 42.29Q86.16 41.96 86.81 41.96L86.89 42.05L86.94 42.10Q89.19 42.15 90.60 44.12L90.46 43.98L90.56 44.08Q89.27 36.70 89.35 26.54L89.37 26.56L89.32 26.51Q88.62 26.76 87.78 26.88L87.79 26.89L87.77 25.00L87.75 24.97Q86.70 25.07 85.91 25.00L86.00 25.09L85.86 24.95Q85.06 24.92 84.19 24.42L84.23 24.46L84.17 24.41Q84.34 26.48 84.34 28.53L84.38 28.57L84.34 28.53Q84.35 35.59 83.48 41.87ZM85.94 22.83L85.95 22.83L86.23 22.74L86.30 22.50L86.27 22.47Q86.70 23.28 87.73 24.77L87.69 24.73L87.66 24.70Q89.13 22.47 90.46 18.93L90.40 18.87L90.38 18.85Q89.47 18.05 87.90 16.45L87.86 16.41L88.00 16.55Q87.87 16.72 87.60 17.18L87.48 17.05L87.53 17.10Q86.58 15.85 85.67 14.41L85.66 14.40L85.62 14.36Q84.18 16.00 83.00 16.34L83.19 16.53L83.11 16.46Q84.19 19.90 86.02 22.91Z\"/><path d=\"M21 22 C70 26,90 17,131 18\" stroke=\"#777\" fill=\"none\"/></svg>",
                "sessionId": "66cefb765b9090bcfc680542",
                "message": "Success"
            };
        }
            
        
    
        // ใช้ DomSanitizer เพื่อทำให้ SVG ปลอดภัยในการแสดง
        this.captchaSvg = this.sanitizer.bypassSecurityTrustHtml(body.captchaSvg);
    }

    checkCaptcha(): boolean {
        console.log("this.captch_input", this.captch_input);

        this.isCaptchaValid = CaptchaService.checkCaptcha(this.captch_input);
        if (!this.isCaptchaValid) {
            this.captch_input = ''; // ล้างค่า input ถ้าไม่ถูกต้อง
        }
        return this.isCaptchaValid;
    }

    reloadCaptchaOnFail(): void {
        this.createCaptcha('1'); // สร้าง CAPTCHA ใหม่
        this.captch_input = ''; // รีเซ็ตค่า input ที่ผู้ใช้กรอก
    }

    manualReloadCaptcha(): void {
        this.createCaptcha('1'); // สร้าง CAPTCHA ใหม่
        this.captch_input = ''; // รีเซ็ตค่า input ที่ผู้ใช้กรอก
        this.isCaptchaValid = true; // รีเซ็ตสถานะการตรวจสอบเมื่อรีโหลด CAPTCHA ใหม่
    }
}
